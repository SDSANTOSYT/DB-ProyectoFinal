version: "3.9"

services:
  oracle-db:
    image: gvenzl/oracle-xe:21-slim
    container_name: oracle-db
    environment:
      ORACLE_PASSWORD: mypassword
      ORACLE_DATABASE: APPDB
    ports:
      - "11521:1521"          # desde tu PC -> contenedor
    volumes:
      - oracle-data:/opt/oracle/oradata

  backend:
    build:
      context: ./Backend      # cambialo a ./backend si tu carpeta es así
      dockerfile: Dockerfile
    container_name: backend
    depends_on:
      - oracle-db
    environment:
      ORACLE_USER: APP_USER
      ORACLE_PASSWORD: app_password
      ORACLE_HOST: oracle-db   # nombre del servicio, NO localhost
      ORACLE_PORT: "1521"
      ORACLE_SERVICE: XEPDB1   # o APPDB si usas ese
    ports:
      - "8000:8000"
    develop:
      watch:
        # Si cambian dependencias, reconstruye la imagen del backend
        - path: ./Backend/requirements.txt
          action: rebuild
        # Si cambia el código, lo sincroniza dentro del contenedor en /app
        - path: ./Backend
          target: /app
          action: sync

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile   # tu Dockerfile de dev con npm run dev
    container_name: frontend
    depends_on:
      - backend
    ports:
      - "5173:5173"
    develop:
      watch:
        # Si cambian dependencias del front, reconstruye
        - path: ./frontend/package.json
          action: rebuild
        # Si cambia código del front, lo sincroniza dentro del contenedor
        - path: ./frontend
          target: /app
          action: sync

volumes:
  oracle-data:
